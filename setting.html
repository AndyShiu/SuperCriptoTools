<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>SuperCryptoTools(beta 1.0)</title>
        <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" />
        <link href="css/styles.css" rel="stylesheet" />
		<link rel="stylesheet" href="https://kendo.cdn.telerik.com/2021.2.616/styles/kendo.common.min.css" />
		<link rel="stylesheet" href="https://kendo.cdn.telerik.com/2021.2.616/styles/kendo.default.min.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" crossorigin="anonymous"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="https://kendo.cdn.telerik.com/2021.2.616/js/kendo.all.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </head>
    <body class="sb-nav-fixed">
        <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
            <!-- Navbar Brand-->
            <a class="navbar-brand ps-3" href="index.html">SuperCryptoTools</a>
            <!-- Sidebar Toggle-->
            <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>
            
            
            <!-- Navbar-->
            <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
               
            </ul>
        </nav>
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                    <div class="sb-sidenav-menu">
                        <div class="nav">
                            <div class="sb-sidenav-menu-heading">功能</div>
                            <a class="nav-link" href="index.html">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                儀表板
                            </a>
							
							<a class="nav-link" href="rates.html">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                法幣匯率
                            </a>
							
							<a class="nav-link" href="setting.html">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                個人化設定
                            </a>
							
							<a class="nav-link" href="feedback.html">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                意見回饋
                            </a>
                        </div>
                    </div>
                    <div class="sb-sidenav-footer">
                        <div class="small">資料與圖表來源:</div>
						<h3>TradingView</h3>               
                    </div>
                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid px-4">
                        <h1 class="mt-4">個人化設定</h1>
                        <ol class="breadcrumb mb-4">
                            <li class="breadcrumb-item active">提供個人化的設定</li>
                        </ol>
                        <div class="row">
							<div class="col-12">
                                <font size="1">代號查詢方式 -> <a href="settingTeach.html">點此</a></font>
                            </div>
                            
							<div class="col-12 text-end">
								<button type="button" class="btn btn-danger" onclick='reset()'>恢復預設值</button>
							</div>
							<div class="col-12">
                                <hr/>
                            </div>
							
                        </div>
						
                        <div class="row">
                            <div class="col-xl-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-area me-1"></i>
                                        Overview(總覽頁面) - 市值/優勢指數參數設定
                                    </div>
                                    <div class="card-body">
										<div id="market-dominance-grid"></div>
									</div>
                                </div>
                            </div>
                            <div class="col-xl-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-area me-1"></i>
                                        Overview(總覽頁面) - 價格跑馬燈參數設定
                                    </div>
                                    <div class="card-body">
										<div id="marquee-grid"></div>
									</div>
                                </div>
                            </div>
                        </div>
						
						<div class="row">
                            <div class="col-xl-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-area me-1"></i>
                                        Overview(總覽頁面) - 市場即時圖表參數設定
                                    </div>
                                    <div class="card-body">
										<div id="market-img-grid"></div>
									</div>
                                </div>
                            </div>
                            <div class="col-xl-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="fas fa-chart-area me-1"></i>
                                        Overview(總覽頁面) - 市場數據參數設定
                                    </div>
                                    <div class="card-body">
										<div id="market-grid"></div>
									</div>
                                </div>
                            </div>
                        </div>
						
						
                        <div class="row">
                            <div class="col-12">
                                <hr/>
                            </div>
							
                        </div>
                    </div>
                </main>
                <footer class="py-4 bg-light mt-auto">
                    <div class="container-fluid px-4">
                        <div class="d-flex align-items-center justify-content-between small">
                            <div class="text-muted">Copyright &copy; AndyShiu 2021 ‧ <a href="https://github.com/AndyShiu/SuperCryptoTools">Github</a> </div>
                            
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>
		<script src="js/data.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" crossorigin="anonymous"></script>
		<script>
		
		var global = [];
        $(document).ready(function () {
			getMarDomGridData();
            initMarDomGrid();
			
			getMarqueeGridData();
			initMarQueeGrid();
			
			getMarketImgData();
			initMarketImgGrid();
			
			getMarketListData();
			initMarketListGrid();
        });
		function getMarDomGridData(){
		
		
			global.mdData = JSON.parse(window.localStorage.getItem("MarDomData"));
			
			if(global.mdData==null){
				global.mdData = mdDefData;
			
			}
			
		}
		function initMarDomGrid(){
			global.mdGrid = 
			$("#market-dominance-grid").kendoGrid({
                dataSource: {
                    type: "json",
                    data: global.mdData,
                    pageSize: 20,
					schema: {
                        model: {
                            id: "proName",
                            fields: {
                                order: { type: "number", validation: { required: true } },
                                description: { validation: { required: true } },
                                proName: { validation: { required: true} } 
							}
                        }
                    }
                    
                },
				toolbar: [	
							{ name: "create" },
							{ name: "save" },
							{ name: "cancel" }
						 ],
                height: 550,
				editable: true,
				confirmation: false,
			    saveChanges: function(e) {
				  //if (!confirm("Are you sure you want to save all changes?")) {
				     //e.preventDefault();
				  //}else{
					//window.localStorage.setItem("MarDomData",JSON.stringify($("#market-dominance-grid").data("kendoGrid").dataSource.data()));	
					//console.log(JSON.parse(JSON.stringify($("#market-dominance-grid").data("kendoGrid").dataSource.data())));
				  //}
				  
				  $("#market-dominance-grid").data("kendoGrid").dataSource.data().sort(function(a, b) {
						if (true) {
							return (a['order'] > b['order']) ? 1 : ((a['order'] < b['order']) ? -1 : 0);
						} else {
							return (b['order'] > a['order']) ? 1 : ((b['order'] < a['order']) ? -1 : 0);
						}
					});
				  
				  window.localStorage.setItem("MarDomData",JSON.stringify($("#market-dominance-grid").data("kendoGrid").dataSource.data()));	
				  Swal.fire(
					  '儲存成功!',
					  '資料儲存成功!',
					  'success'
					)
			    },
				
                pageable: {
                    
                },
                columns: [{
                    field: "order",
                    title: "順序",
					width: "25px"
                }, {
                    field: "description",
                    title: "自訂名稱",
					width: "100px"
                },{
                    field: "proName",
                    title: "Tradingview 代號",
					width: "100px"
                },{ command: ["destroy"], title: "&nbsp;", width: "55px" }]
            });
			
			
			
		}
    
		function initMarQueeGrid(){
				global.marqueeGrid = 
				$("#marquee-grid").kendoGrid({
					dataSource: {
						type: "json",
						data: global.marQueeData ,
						pageSize: 20,
						schema: {
							model: {
								id: "proName",
								fields: {
									order: { type: "number", validation: { required: true } },
									description: { validation: { required: true } },
									proName: { validation: { required: true} } 
								}
							}
						}
						
					},
					toolbar: [	
								{ name: "create" },
								{ name: "save" },
								{ name: "cancel" }
							 ],
					height: 550,
					editable: true,
					confirmation: false,
					saveChanges: function(e) {
					  
					  
					  $("#marquee-grid").data("kendoGrid").dataSource.data().sort(function(a, b) {
							if (true) {
								return (a['order'] > b['order']) ? 1 : ((a['order'] < b['order']) ? -1 : 0);
							} else {
								return (b['order'] > a['order']) ? 1 : ((b['order'] < a['order']) ? -1 : 0);
							}
						});
					  
					  window.localStorage.setItem("MarqueeData",JSON.stringify($("#marquee-grid").data("kendoGrid").dataSource.data()));	
					  Swal.fire(
						  '儲存成功!',
						  '資料儲存成功!',
						  'success'
						)
					},
					
					pageable: {
						
					},
					columns: [{
						field: "order",
						title: "順序",
						width: "25px"
					}, {
						field: "description",
						title: "自訂名稱",
						width: "100px"
					},{
						field: "proName",
						title: "Tradingview 代號",
						width: "100px"
					},{ command: ["destroy"], title: "&nbsp;", width: "55px" }]
				});
				
		}
		
		function getMarqueeGridData(){
			global.marQueeData = JSON.parse(window.localStorage.getItem("MarqueeData"));
				if(global.marQueeData==null){
					global.marQueeData = marqueeData;			
				}
		}
			
		function getMarketImgData(){
			global.marketImgData = JSON.parse(window.localStorage.getItem("MarketImgData"));			
			if(global.marketImgData==null){
				global.marketImgData = marketImgData;			
			}			
		}
		function initMarketImgGrid(){
			global.marketImgGrid = 
				$("#market-img-grid").kendoGrid({
					dataSource: {
						type: "json",
						data: global.marketImgData ,
						pageSize: 20,
						schema: {
							model: {
								id: "proName",
								fields: {
									order: { type: "number", validation: { required: true } },
									description: { validation: { required: true } },
									proName: { validation: { required: true} } 
								}
							}
						}
						
					},
					toolbar: [	
								{ name: "create" },
								{ name: "save" },
								{ name: "cancel" }
							 ],
					height: 550,
					editable: true,
					confirmation: false,
					saveChanges: function(e) {
					  
					  
					  $("#market-img-grid").data("kendoGrid").dataSource.data().sort(function(a, b) {
							if (true) {
								return (a['order'] > b['order']) ? 1 : ((a['order'] < b['order']) ? -1 : 0);
							} else {
								return (b['order'] > a['order']) ? 1 : ((b['order'] < a['order']) ? -1 : 0);
							}
						});
					  
					  window.localStorage.setItem("MarketImgData",JSON.stringify($("#market-img-grid").data("kendoGrid").dataSource.data()));	
					  Swal.fire(
						  '儲存成功!',
						  '資料儲存成功!',
						  'success'
						)
					},
					
					pageable: {
						
					},
					columns: [{
						field: "order",
						title: "順序",
						width: "25px"
					}, {
						field: "description",
						title: "自訂名稱",
						width: "100px"
					},{
						field: "proName",
						title: "Tradingview 代號",
						width: "100px"
					},{ command: ["destroy"], title: "&nbsp;", width: "55px" }]
				});
		} 
		
		function getMarketListData(){
			global.mlData = JSON.parse(window.localStorage.getItem("MarketListData"));
			
			if(global.mlData==null){
				global.mlData = marketListData;
			
			}
		}	
	
		function initMarketListGrid(){
			global.mlGrid = 
			$("#market-grid").kendoGrid({
                dataSource: {
                    type: "json",
                    data: global.mlData,
                    pageSize: 20,
					schema: {
                        model: {
                            id: "name",
                            fields: {
                                order: { type: "number", validation: { required: true } },
                                displayName: { validation: { required: true } },
                                name: { validation: { required: true} } 
							}
                        }
                    }
                    
                },
				toolbar: [	
							{ name: "create" },
							{ name: "save" },
							{ name: "cancel" }
						 ],
                height: 550,
				editable: true,
				confirmation: false,
			    saveChanges: function(e) {
				  //if (!confirm("Are you sure you want to save all changes?")) {
				     //e.preventDefault();
				  //}else{
					//window.localStorage.setItem("MarDomData",JSON.stringify($("#market-dominance-grid").data("kendoGrid").dataSource.data()));	
					//console.log(JSON.parse(JSON.stringify($("#market-dominance-grid").data("kendoGrid").dataSource.data())));
				  //}
				  
				  $("#market-grid").data("kendoGrid").dataSource.data().sort(function(a, b) {
						if (true) {
							return (a['order'] > b['order']) ? 1 : ((a['order'] < b['order']) ? -1 : 0);
						} else {
							return (b['order'] > a['order']) ? 1 : ((b['order'] < a['order']) ? -1 : 0);
						}
					});
				  
				  window.localStorage.setItem("MarketListData",JSON.stringify($("#market-grid").data("kendoGrid").dataSource.data()));	
				  Swal.fire(
					  '儲存成功!',
					  '資料儲存成功!',
					  'success'
					)
			    },
				
                pageable: {
                    
                },
                columns: [{
                    field: "order",
                    title: "順序",
					width: "25px"
                }, {
                    field: "displayName",
                    title: "自訂名稱",
					width: "100px"
                },{
                    field: "name",
                    title: "Tradingview 代號",
					width: "100px"
                },{ command: ["destroy"], title: "&nbsp;", width: "55px" }]
            });
		}
		
		
		function reset(){
		
			Swal.fire({
			  title: '是否要恢復預設值?',
			  text: "恢復預設值後，將刪除你所有個人化設定",
			  icon: 'warning',
			  showCancelButton: true,
			  confirmButtonColor: '#3085d6',
			  cancelButtonColor: '#d33',
			  confirmButtonText: '是的！我要恢復預設值',
			  cancelButtonText: '取消'
			}).then((result) => {
			  if (result.isConfirmed) {
				  localStorage.clear();
				  Swal.fire({
					  title: '恢復預設值成功！',
					  text:'您的資料已恢復為初始設定(3秒後自動重新整理)',
					  icon: 'success',
					  allowEscapeKey :false,
					  allowOutsideClick : false,
					  allowEnterKey: false,
					  showConfirmButton: false
					});
					
					setTimeout(
					  function() 
					  {
						location.reload();
					  }, 3000);
				  
				  
			  }
			})
		}
	</script>
    </body>
</html>
